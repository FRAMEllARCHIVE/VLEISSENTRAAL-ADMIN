<!DOCTYPE html>
<!-- Legal Footnote: This content is subject to copyright and should not be reproduced without permission. -->
<!-- Written and created by Thomas John-Michael de Beer, feel free to contact me via tjdebeer@gmail.com  -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VLEISSENTRAAL</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="Join VLEISSENTRAAL Livestock Auctions to bid on premium livestock.">
  <meta name="keywords" content="livestock, auction, bidding, cattle, sheep, VLEISSENTRAAL">
  <meta name="author" content="VLEISSENTRAAL">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2c3e50;
      --accent-color: #27ae60;
      --text-color: #333;
      --bg-color: #f4f4f4;
    }

    * {
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background-color: var(--bg-color);
    }

.container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

.banner {
      width: 100%;
      object-fit: cover;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }

.product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      scroll-snap-type: y mandatory;
    }

    .product-card {
      position: relative;
      background-color: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

.product-card .favorite {
  position: absolute;
  top: 0px;
  right: 3px;
  color: #f39c12;
  cursor: pointer;
      z-index: 1003;
      opacity: 0.3;
      transition: 0.3s ease;
      padding: 10px;
}

.product-card .favorite:hover {
      color: #e67e22;
      transform: scale(1.1);
      opacity: 1;
}

.product-card .refresh-icon {
  position: absolute;
  top: 0px;
  left: 0px;
  color: #2980b9;
  cursor: pointer;
  z-index: 1003;
  opacity: 0.4;
  transition: 0.3s ease;
  padding: 15px;
}

.product-card .refresh-icon:hover {
  opacity: 0.6;
  transform: scale(1.1);
}

.rotate {
  animation: rotateIcon 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
}

@keyframes rotateIcon {
  0%, 100% {
    transform: rotate(0deg) scale(1);
    opacity: 0.9;
  }
  50% {
    transform: rotate(180deg) scale(1.2);
    opacity: 1;
  }
  100% {
    transform: rotate(360deg) scale(1);
    opacity: 0.9;
  }
}

.product-video-container {
    position: relative;
    width: 100%;
    padding-top: 56.25%;
    overflow: hidden;
    background-color: #000;
}

.product-video {
    position: absolute;
    top: 0;
    left: 0;
    width: 101%;
    height: 101%;
    object-fit: cover;
}

    .product-info {
      padding: 15px;
    }

    .product-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    .product-description {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 10px;
    }

    .product-price {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--accent-color);
      margin-bottom: 10px;
    }

    .countdown {
      font-size: 0.9rem;
      color: #e74c3c;
      font-weight: bold;
    }

footer {
  padding: 0.95rem;
  text-align: center;
  background-color: #333;
  color: white; 
  width: 100%;
}

#overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: none;
      z-index: 2000;
    }

#AddProduct {
      width: 88px;
      height: 88px;
      background-color: #1A2A5E;
      border-radius: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 auto;
      box-shadow: 0 3px 4px rgba(0, 0, 0, 0.4);
      cursor: pointer;
      font-size: 48px;
      color: white;
      font-weight: bold;
      transition: 0.3s;
      opacity: 0.9;
    }

    #AddProduct:hover {
      background-color: #1A2A5E;
      transform: scale(1.1);
      opacity: 1;
    }

    #AddProduct i {
      transition: transform 0.3s;
    }

    #AddProduct:hover i {
      transform: scale(1.2);
    }

#productForm {
  letter-spacing: 0.5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: none;
  width: 80vw;
  max-width: 300px;
  padding: 20px;
  background-color: #f0f0f0;
  border: 1px solid #ccc;
  border-radius: 33px;
  margin-top: 20px;
  z-index: 2222;
  text-align: center;
}

#productForm label {
  display: block;
  margin-bottom: 8px;
  text-align: center;
}

#productForm input[type="text"],
#productForm textarea,
#productForm input[type="file"],
#productForm input[type="url"],
#productForm button {
      width: calc(100% - 20px);
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 18px;
      margin-bottom: 12px;
      box-sizing: border-box;
      text-align: center;
}

#productForm button {
  letter-spacing: 1.1px;
  padding: 10px 20px;
  background-color: #1A2A5E;
  color: white;
  border: none;
  border-radius: 18px;
  cursor: pointer;
  font-size: 14px;
      opacity: 0.9;
}

#productForm button:hover {
  background-color: #1A2A5E;
      opacity: 1;
}

    #RefreshList {
      width: 88px;
      height: 88px;
      background-color: transparent;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 auto;
      cursor: pointer;
      font-size: 48px;
      color: #1A2A5E;
      font-weight: bold;
      transition: 0.3s;
      opacity: 0.9;
    }

    #RefreshList:hover {
      transform: scale(1.1);
      opacity: 1;
    }

    #RefreshList i {
      transition: transform 0.3s;
    }

    #RefreshList:hover i {
      animation: rotateIcon 2s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
      transform: scale(1.2);
    }

.spinner-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3333;
        }

.spinner {
    font-size: 6rem;
    color: #3498db;
}

  </style>
</head>
<body>
  <img src="edgehill2.png" alt="Edgehill Greens Livestock Auction" class="banner">


  <main class="container" style="margin-top: 20px;">
<br>
  <div id="AddProduct" onclick="AddProduct()">
    <i class="fas fa-plus"></i>
  </div>
<br><br>
    <div class="product-grid" id="productGrid">

    </div>
  </div>

<br>
    </div>
  </main>
<br>
  <div id="RefreshList" onclick="RefreshList()">
                <i class="fas fa-sync-alt refresh-icon"></i>
  </div>
<br><br>
<footer>
   VLEISSENTRAAL Â© 2024. <br>
   All Rights Reserved.
</footer>

<div id="overlay" onclick="hideProductForm()"></div>


<div id="productForm" style="display: none;">
  <label for="productTitle">Product Title:</label>
  <input type="text" id="productTitle" name="productTitle" required><br>

  <label for="productDescription">Product Description:</label>
  <input type="text" id="productDescription" name="productDescription" required><br>

  <label for="startingPrice">Starting Price:</label>
  <input type="text" id="startingPrice" name="startingPrice" required><br>

  <label for="productVideo">Product Video URL:</label>
  <input type="url" id="productVideo" name="productVideo" required>
  <br><br>
  <a href="https://streamable.com/" target="_blank" style="display: inline-block; padding: 0px; border-radius: 22px; overflow: hidden; width: 60%; height: 44px;">
    <img src="streamable.png" alt="Streamable" style="display: block; width: 100%; height: 100%; object-fit: cover;">
  </a>
  <br><br>

  <button id="submitButton" type="submit">SUBMIT</button>
</div>

    <div class="spinner-container" id="spinner">
        <i class="fas fa-spinner fa-spin spinner"></i>

  <script>

const repo = 'EDGEHILLGREENS/llll';
const merpmerp = 'Z2hwX2Q0Q';
const gloopdoop = 'zdSSVFhSzNZ';
const dloogdloog = 'MXNhUnlxSzIz';
const herpherp = gloopdoop + dloogdloog;
const derpderp = 'UEg3clN0Q2hkeDNsSGIwSw==';
const joojooo = merpmerp + herpherp + derpderp;

document.getElementById('submitButton').addEventListener('click', function(event) {
    event.preventDefault();

    const productTitle = document.getElementById('productTitle').value;
    const productDescription = document.getElementById('productDescription').value;
    const startingPrice = document.getElementById('startingPrice').value;
    const productVideoUrl = document.getElementById('productVideo').value;

    const specialCharRegex = /[!@#$%^&*()?":{}|<>]/g;

    function containsSpecialCharacters(str) {
        return specialCharRegex.test(str);
    }

    if (productTitle && productDescription && startingPrice && productVideoUrl) {
        if (containsSpecialCharacters(productTitle) || containsSpecialCharacters(productDescription) || containsSpecialCharacters(startingPrice)) {
            alert('Special characters are not allowed.');
            return;
        }

        try {
            new URL(productVideoUrl);
        } catch (_) {
            alert('Please enter a valid URL.');
            return;
        }

            const moo = atob(joojooo);
            const currentTimestamp = getCurrentTimestamp().substring(0, 12);
            const expiryTimestamp = addHoursToTimestamp(currentTimestamp, 48);
            const encodedVideoUrl = encodeURIComponent(productVideoUrl);
            const encodedVideoUrl2 = encodedVideoUrl.replace(/%/g, '[');
            const newFileName = `@${encodedVideoUrl2}^${productDescription}!${expiryTimestamp}${productTitle}$${startingPrice}`;

           console.log('Generated file name:', newFileName);

           showSpinner();

        createFile(repo, newFileName, '', moo)
            .then(() => {
                console.log('File created successfully');
            })
            .catch(error => {
                console.error('Error uploading file:', error);
                alert('Upload failed');
            })
            .finally(() => {
                hideSpinner();
                hideProductForm();
            });
    } else {
        alert('Please fill in all fields and provide a video URL.');
    }
});

function showSpinner() {
            document.getElementById('spinner').style.display = 'flex';
        }
function hideSpinner() {
            document.getElementById('spinner').style.display = 'none';
        }

function createFile(repo, fileName, content, moo) {
  const apiUrl = `https://api.github.com/repos/${repo}/contents/${fileName}`;

  return fetch(apiUrl, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${moo}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: `Create file ${fileName}`,
      content: btoa(content)
    })
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok ' + response.statusText);
    }
    return response.json();
  });
}

function addHoursToTimestamp(timestamp, hoursToAdd) {
    const year = parseInt(timestamp.substring(0, 4), 10);
    const month = parseInt(timestamp.substring(4, 6), 10) - 1;
    const day = parseInt(timestamp.substring(6, 8), 10);
    const hour = parseInt(timestamp.substring(8, 10), 10);
    const minute = parseInt(timestamp.substring(10, 12), 10);
    
    const date = new Date(year, month, day, hour, minute);
    date.setHours(date.getHours() + hoursToAdd);
    
    const newYear = date.getFullYear();
    const newMonth = String(date.getMonth() + 1).padStart(2, '0');
    const newDay = String(date.getDate()).padStart(2, '0');
    const newHour = String(date.getHours()).padStart(2, '0');
    const newMinute = String(date.getMinutes()).padStart(2, '0');
    
    return `${newYear}${newMonth}${newDay}${newHour}${newMinute}`;
}

function RefreshList() {
    setTimeout(() => {
        location.reload();
    }, 2222);
}

function hideProductForm() {
  overlay.style.display = 'none';
  productForm.style.display = 'none';
}

function AddProduct() {
  const overlay = document.getElementById('overlay');
  const productForm = document.getElementById('productForm');
  overlay.style.display = 'block';
  productForm.style.display = 'block';

}

document.addEventListener('DOMContentLoaded', () => {

                                                    const moo = atob(joojooo);
                                                        const repo = 'EDGEHILLGREENS/llll';
                                                                const repo2 = 'EDGEHILLGREENS/ll';
                                                                        const apiUrl = `https://api.github.com/repos/${repo}/contents`;
                                                                                                                                                const prefix = '@';

    fetch(apiUrl, {
      headers: {
        'Authorization': `token ${moo}`
      }
    })
    .then(response => response.json())
    .then(data => {
      const productGrid = document.getElementById('productGrid');
      data.forEach(file => {
        if (file.name.startsWith(prefix)) {
          const fileName = file.name;
          const parts = fileName.split(/[@^!$]+/);

          const videoName = parts[1].trim();
          const decodedVideoName2 = videoName.replace(/\[/g, '%');
          const decodedVideoName = decodeURIComponent(decodedVideoName2);
          const regex = /^(https:\/\/streamable.com\/)([a-zA-Z0-9]+)$/;
          const decodedVideoName3 = decodedVideoName.replace(regex, '$1e/$2?');
          const productDescription = parts[2].trim();
          const productTitle = parts[3].trim().substring(12);
          const productID = parts[3].trim();
          const currentPrice = parseFloat(parts[4]);
          const expiryDateString = parts[3].trim().substring(0, 12);      
          const year = parseInt(expiryDateString.substring(0, 4));
          const month = parseInt(expiryDateString.substring(4, 6)) - 1;
          const day = parseInt(expiryDateString.substring(6, 8));
          const hour = parseInt(expiryDateString.substring(8, 10));
          const minute = parseInt(expiryDateString.substring(10, 12));
          const expiryDate = new Date(year, month, day, hour, minute);

          const productCard = document.createElement('div');
          productCard.classList.add('product-card');
          
          productCard.innerHTML = `
            <span class="favorite">
            <i class="fa fa-star"></i>
            </span>
            <i class="fas fa-sync-alt refresh-icon"></i>
<div class="product-video-container">
    <iframe class="product-video" src="${decodedVideoName3}" frameborder="0" allowfullscreen></iframe>
</div>
    <div class="product-info">
            <h2 class="product-title">${productTitle}</h2>
            <p class="product-description">${productDescription}</p>
            <p class="product-price" data-current-price="${currentPrice}">Current Price: R${currentPrice}</p> 
            <p class="highest-bidder"></p>
            <p class="bidder-contact"></p>
            <p class="bid-time"></p>
<br>
            </form>
              <p class="countdown"></p>
              <p class="product-id" style="display: none;">${productID}</p>
            </div>
          `;

          productGrid.appendChild(productCard);

          const countdownElement = productCard.querySelector('.countdown');
          updateCountdown(expiryDate, countdownElement, productCard);
          setInterval(() => updateCountdown(expiryDate, countdownElement, productCard), 60000);

        productCard.querySelector('.refresh-icon').addEventListener('click', function() {
          const refreshIcon = this;
          refreshIcon.classList.add('rotate');
          setTimeout(() => {
            refreshIcon.classList.remove('rotate');
          }, 4444);
          refreshPrice(productID, moo, repo2, productCard);
        });
        refreshPrice(productID, moo, repo2, productCard);
      }
    });
  })
    .catch(error => {
      console.error('Error fetching repository contents:', error);
    });
  });

function updateCountdown(expiryDate, countdownElement, productCard) {
    const now = new Date().getTime();
    const timeLeft = expiryDate - now;

    if (timeLeft > 0) {
      const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));

      countdownElement.textContent = `Auction ends in: ${days}d ${hours}h ${minutes}m`;
    } else {
      countdownElement.textContent = 'Auction has ended';
      productCard.remove();
    }
  }

function getCurrentTimestamp() {
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');

  return `${year}${month}${day}${hours}${minutes}${seconds}`;
}

function refreshPrice(productID, moo, repo2, productCard) {
  const apiUrl = `https://api.github.com/repos/${repo2}/contents`;

  fetch(apiUrl, {
    headers: {
      'Authorization': `token ${moo}`
    }
  })
  .then(response => response.json())
  .then(data => {
    const matchingFiles = data.filter(file => file.name.startsWith(productID));
    let highestBid = 0;
    let highestBidder = '';
    let contactDetails = '';
    let bidTime = '';

    matchingFiles.forEach(file => {
      const bidParts = file.name.split('$');
      if (bidParts.length > 1) {
        const bidAmountPart = bidParts[1].split('!')[0];
        const bidAmount = parseFloat(bidAmountPart);
        
        if (bidAmount > highestBid) {
          highestBid = bidAmount;


          const detailsParts = file.name.split('!');
          if (detailsParts.length > 1) {
            highestBidder = detailsParts[1].split('[')[0].substring(14);
            contactDetails = detailsParts[1].split('[')[1].split(']')[0];
          }
          bidTime = file.name.split('@')[1].split('$')[0];
          if (bidTime.length === 14) {
            bidTime = `${bidTime.substring(0, 4)}/${bidTime.substring(4, 6)}/${bidTime.substring(6, 8)} ${bidTime.substring(8, 10)}:${bidTime.substring(10, 12)}:${bidTime.substring(12, 14)}`;
          }
        }
      }
    });

    if (highestBid > 0) {
      const priceElement = productCard.querySelector('.product-price');
      priceElement.textContent = `Current Price: R${highestBid}`;
      priceElement.setAttribute('data-current-price', highestBid);

      const highestBidderElement = productCard.querySelector('.highest-bidder');
      highestBidderElement.textContent = `Highest Bidder: ${highestBidder}`;

      const contactDetailsElement = productCard.querySelector('.bidder-contact');
      contactDetailsElement.textContent = `Contact no. ${contactDetails}`;
      
      const bidTimeElement = productCard.querySelector('.bid-time');
      bidTimeElement.textContent = `${bidTime}`;
    }
  })
  .catch(error => {
    console.error('Error fetching repository contents for refresh:', error);
  });
}

  </script>
</body>
</html>
